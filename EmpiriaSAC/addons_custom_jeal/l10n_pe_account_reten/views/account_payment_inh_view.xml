<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data noupdate="0">
        <record id="view_retention_account_payment_inh_form" model="ir.ui.view">
            <field name="name">view.retention.account.payment.inh.form</field>
            <field name="model">account.payment</field>
            <field name="inherit_id" ref="account.view_account_payment_form" />
            <field name="arch" type="xml">
                <xpath expr="//sheet/div[@name='button_box']/button[@name='button_open_invoices']" position="before">
                    <button name="open_related_account_retention" type="object" groups="l10n_pe_account_reten.group_retention_operador" class="oe_stat_button" icon="fa-book" string="Comprobante Retención" attrs="{'invisible': [('retention_id', 'in', [False,''])]}"/>
                </xpath>

                <xpath expr="//group/group/label[@for='amount']" position="before">
                    <!-- Contenedor para los campos de agente de retención y retención -->
                    <label for="is_retention_agent" string="¿Es Agente de Retención?" groups="l10n_pe_account_reten.group_retention_operador"/>
                    <div name="retention_info_div" class="o_row" groups="l10n_pe_account_reten.group_retention_operador">
                        <field name="is_retention_agent" widget="boolean_toggle" />

                        <!-- Etiqueta y campo booleano que indica si el pago tiene retención, visible solo si es agente de retención -->
                        <label for="has_retention" string="¿Tiene Retención?" attrs="{'invisible': [('is_retention_agent', '!=', True)]}" />
                        <field name="has_retention" widget="boolean_toggle" attrs="{'invisible': [('is_retention_agent', '!=', True)]}" />
                    </div>

                    <field name="amount_base"/>
                </xpath>

                <xpath expr="//sheet/group" position="after">
                    <notebook colspan="4">
                        <page string="Retención" name="retention" groups="l10n_pe_account_reten.group_retention_operador" attrs="{'invisible': [('has_retention', '!=', True)]}">
                            <!-- Contenedor para los campos relacionados con la retención -->
                            <group>
                                <group>
                                    <field name="retention_id" invisible="1" options="{'no_open': True, 'no_create': True}" />

                                    <!-- Base retenida y porcentaje de retención -->
                                    <label for="amount_retention" string="Importe Retenido" />
                                    <div name="retention_fields_div" class="o_row">
                                        <field name="amount_retention" nolabel="1" />
                                        <label for="percentage_retention" string="%" />
                                        <field name="percentage_retention" nolabel="1" />
                                    </div>

                                    <!-- Diario, cuenta y tipo de documento para la retención -->
                                    <field name="journal_retention_id" options="{'no_open': True, 'no_create': True}" />
                                    <field name="account_retention_id" options="{'no_open': True, 'no_create': True}" />
                                    <field name="document_type_retention_id" options="{'no_open': True, 'no_create': True}" />
                                </group>

                                <group>
                                    <!-- Otros campos relacionados con la retención -->
                                    <field name="retention_sequence" invisible="1" />

                                    <field name="amount_minimum_retention" />

                                    <label for="retention_series" string="Serie" />
                                    <div name="retention_correlative_div" class="o_row">
                                        <field name="retention_series" nolabel="1" />
                                        <label for="next_retention_sequence" string="Secuencia" />
                                        <field name="next_retention_sequence" nolabel="1" />
                                    </div>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
